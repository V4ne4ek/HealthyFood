let dishes = [
    {
        name: "Яйцо",
        weight: "100",
        Protein: "7.8",
        Fat: "7.2",
        Сarbohydrates: "0.42",
        kcal: "95.4",
        image: "src/images/eggs.jpg",
        meal: ["breakfast", "dinner", "snack"]
    },
    {
        name: "Банан",
        weight: "100",
        Protein: "1.09",
        Fat: "0.33",
        Сarbohydrates: "22.84",
        kcal: "89",
        image: "src/images/bananas.jpg",
        meal: ["breakfast", "snack"]
    },
    {
        name: "Куриная грудка",
        weight: "100",
        Protein: "29.55",
        Fat: "7.72",
        Сarbohydrates: "0",
        kcal: "195",
        image: "src/images/chicken_breast.jpeg",
        meal: ["lunch", "dinner"]
    },
    {
        name: "Авокадо",
        weight: "100",
        Protein: "2",
        Fat: "20",
        Сarbohydrates: "6",
        kcal: "212",
        image: "src/images/avocado.jpeg",
        meal: ["breakfast", "lunch"]
    },
    {
        name: "Рис",
        weight: "100",
        Protein: "6.06",
        Fat: "0.53",
        Сarbohydrates: "72.79",
        kcal: "330",
        image: "src/images/rice.jpg",
        meal: ["lunch", "dinner"]
    },
    {
        name: "Макароны",
        weight: "100",
        Protein: "14",
        Fat: "2",
        Сarbohydrates: "69.7",
        kcal: "359",
        image: "src/images/pasta.jpg",
        meal: ["lunch", "dinner"]
    },
    {
        name: "Овсяные хлопья",
        weight: "100",
        Protein: "13.1",
        Fat: "6.2",
        Сarbohydrates: "65.7",
        kcal: "355",
        image: "src/images/oatmeal.jpg",
        meal: ["breakfast", "dinner"]
    },
    {
        name: "Молоко 2,5%",
        weight: "100",
        Protein: "3",
        Fat: "2.5",
        Сarbohydrates: "4.7",
        kcal: "53",
        image: "src/images/milk.jpg",
        meal: ["breakfast", "lunch", "dinner", "snack"]
    },
    {
        name: "Лосось",
        weight: "100",
        Protein: "19.43",
        Fat: "12.12",
        Сarbohydrates: "0",
        kcal: "192",
        image: "src/images/salmon.jpeg",
        meal: ["breakfast", "dinner", "lunch"]
    },
    {
        name: "Помидоры",
        weight: "100",
        Protein: "0.88",
        Fat: "0.2",
        Сarbohydrates: "3.92",
        kcal: "18",
        image: "src/images/tomato.jpg",
        meal: ["breakfast", "lunch", "dinner", "snack"]
    },
    {
        name: "Огурец",
        weight: "100",
        Protein: "0.65",
        Fat: "0.11",
        Сarbohydrates: "3.63",
        kcal: "15",
        image: "src/images/cucumber.jpeg",
        meal: ["breakfast", "lunch", "dinner", "snack"]
    },
    {
        name: "Яблоко",
        weight: "100",
        Protein: "0.28",
        Fat: "0.15",
        Сarbohydrates: "11.2",
        kcal: "57",
        image: "src/images/apple.jpeg",
        meal: ["breakfast", "lunch", "dinner", "snack"]
    },
    {
        name: "Апельсин",
        weight: "100",
        Protein: "0.9",
        Fat: "0.2",
        Сarbohydrates: "8.1",
        kcal: "36",
        image: "src/images/orange.jpg",
        meal: ["breakfast", "lunch", "dinner", "snack"]
    },
    {
        name: "Говядина",
        weight: "100",
        Protein: "26.33",
        Fat: "19.54",
        Сarbohydrates: "0",
        kcal: "288",
        image: "src/images/beef.jpg",
        meal: ["dinner", "lunch"]
    },
    {
        name: "Бульон куриный",
        weight: "100",
        Protein: "0.39",
        Fat: "0.12",
        Сarbohydrates: "0.62",
        kcal: "5",
        image: "src/images/broth.jpg",
        meal: ["breakfast", "lunch", "dinner", "snack"]
    },
    {
        name: "Креветки",
        weight: "100",
        Protein: "26.5",
        Fat: "2.26",
        Сarbohydrates: "1.19",
        kcal: "138",
        image: "src/images/shrimp.jpg",
        meal: ["dinner", "lunch"]
    },
    {
        name: "Грецкий орех",
        weight: "100",
        Protein: "15.23",
        Fat: "65.21",
        Сarbohydrates: "13.71",
        kcal: "654",
        image: "src/images/walnut.jpg",
        meal: ["breakfast", "snack"]
    },
    {
        name: "Миндаль",
        weight: "100",
        Protein: "18.6",
        Fat: "57.7",
        Сarbohydrates: "16.2",
        kcal: "645",
        image: "src/images/almond.jpg",
        meal: ["breakfast", "snack"]
    },
    {
        name: "Протеиновый коктейль",
        weight: "100",
        Protein: "78.13",
        Fat: "5.94",
        Сarbohydrates: "5.63",
        kcal: "388",
        image: "src/images/protein.jpg",
        meal: ["snack"]
    },
    {
        name: "Пармезан",
        weight: "100",
        Protein: "35.75",
        Fat: "25.83",
        Сarbohydrates: "3.22",
        kcal: "392",
        image: "src/images/parmesan.png",
        meal: ["breakfast", "dinner", "lunch", "snack"]
    },
    {
        name: "Хлебцы",
        weight: "100",
        Protein: "10.81",
        Fat: "1.57",
        Сarbohydrates: "73.7",
        kcal: "360",
        image: "src/images/loaves.jpg",
        meal: ["breakfast", "dinner", "lunch", "snack"]
    },
    {
        name: "Масло оливковое",
        weight: "100",
        Protein: "0",
        Fat: "100",
        Сarbohydrates: "0",
        kcal: "884",
        image: "src/images/olive.jpg",
        meal: ["breakfast", "dinner", "lunch"]
    },
    {
        name: "Масло кокосовое",
        weight: "100",
        Protein: "0",
        Fat: "100",
        Сarbohydrates: "0",
        kcal: "857",
        image: "src/images/coconut.jpeg",
        meal: ["breakfast", "dinner", "lunch"]
    },
]


//создание карточек через темплейт

let dishesList = document.querySelector('.dishes__list'),
    dishTemplate = document.querySelector('.dish__template'),
    dish;

for (let i = 0; i < dishes.length; i++) {
    dish = dishTemplate.content.cloneNode(true)
    dish.querySelector('.dish__bottom h2').textContent = dishes[i].name
    dish.querySelector('.info__column h3').textContent = 'БЖУ ' + dishes[i].Protein + '|' + dishes[i].Fat + '|' + dishes[i].Сarbohydrates
    dish.querySelector('.info__column h2').textContent = dishes[i].kcal + ' кКал'
    dish.querySelector('.photo__container img').src = dishes[i].image

    dishesList.append(dish)
}

let dishCard = document.querySelectorAll('.dish')

//присвоение классов карточкам

function classes(array, cards) {
    for (let i = 0; 0 < cards.length; i++) {
        if (array[i] && array[i].meal) {
            for (let j = 0; j < array[i].meal.length; j++) {
                cards[i].classList.add(array[i].meal[j])
            }
        } else {
            return
        }
    }
}

classes(dishes, dishCard)

//фильтрация

document.querySelector('fieldset').addEventListener('click', (event) => {
    if (event.target.tagName !== 'LABEL') return false;

    let filterClass = event.target.dataset['f'];
    dishCard.forEach((elem) => {
        elem.classList.remove('hide');
        if (!elem.classList.contains(filterClass) && filterClass !== 'all') {
            elem.classList.add('hide');
        }
    })
})

//счетчик граммовок и бжу

function newPrice(count) {
    let price = count.querySelector('.price')
    let input = count.querySelector('.counter__value')
    let name = count.querySelector('.name')
    let pfc = count.querySelector('.pfc')
    input.addEventListener("input", function (input) {
        for (let i = 0; i < dishes.length; i++) {
            if (dishes[i].name == name.innerHTML) {
                price.innerHTML = Math.round((input.target.value / 100 * dishes[i].kcal) * 100) / 100 + ' кКал';
                pfc.innerHTML = 'БЖУ ' + (Math.round((input.target.value / 100 * dishes[i].Protein) * 100) / 100) + '|' + (Math.round((input.target.value / 100 * dishes[i].Fat) * 100) / 100) + '|' + (Math.round((input.target.value / 100 * dishes[i].Сarbohydrates) * 100) / 100)
                if (input.target.value == '') {
                    price.innerHTML = dishes[i].kcal + ' кКал';
                    pfc.innerHTML = 'БЖУ ' + dishes[i].Protein + '|' + dishes[i].Fat + '|' + dishes[i].Сarbohydrates
                }
            }
        }
    });
}

let info = document.querySelectorAll('.dish__bottom')
info.forEach(newPrice);

//

let amount = window.localStorage.getItem('calories');

let calories = document.querySelector('.calories__amount');

let caloriesAmount = amount.replace(/[^0-9-.]+/g, '');
//
window.localStorage.setItem('caloriesAmount', caloriesAmount)
//
calories.textContent = caloriesAmount + ' кКал'
// корзина
let eatenArray = JSON.parse(localStorage.getItem('eatenArrayStringified') || '[]')

dishCard.forEach(function (card) {
    let eatButton = card.querySelector('.eat')
    eatButton.addEventListener('click', function () {
        let price = card.querySelector('.price').innerHTML.replace(/[^0-9.]+/g, '')
        let name = card.querySelector('.name').innerHTML
        let pfc = card.querySelector('.pfc').innerHTML
        let macroelements = card.querySelector('.pfc').innerHTML.split('|')
        let protein = macroelements[0].substring(4);
        let fat = macroelements[1];
        let carbohydrates = macroelements[2];
        let img = card.querySelector('.dish__photo').src

        eatenArray.push({
            name: name,
            kcal: price,
            pfc: pfc,
            protein: protein,
            fat: fat,
            carbohydrates: carbohydrates,
            img: img
        })
        caloriesAmount = Number(caloriesAmount) - eatenArray.at(-1).kcal

        calories.textContent = Math.round(caloriesAmount) + ' кКал'

        window.localStorage.setItem('caloriesAmount', caloriesAmount)
        window.localStorage.setItem('calories', calories.textContent)

        window.localStorage.setItem('eatenArrayStringified', JSON.stringify(eatenArray))

        console.log(eatenArray)
    })
})

// кнопка вверх

const btnUp = {
    el: document.querySelector('.btn-up'),
    scrolling: false,
    show() {
        if (this.el.classList.contains('btn-up_hide') && !this.el.classList.contains('btn-up_hiding')) {
            this.el.classList.remove('btn-up_hide');
            this.el.classList.add('btn-up_hiding');
            window.setTimeout(() => {
                this.el.classList.remove('btn-up_hiding');
            }, 300);
        }
    },
    hide() {
        if (!this.el.classList.contains('btn-up_hide') && !this.el.classList.contains('btn-up_hiding')) {
            this.el.classList.add('btn-up_hiding');
            window.setTimeout(() => {
                this.el.classList.add('btn-up_hide');
                this.el.classList.remove('btn-up_hiding');
            }, 300);
        }
    },
    addEventListener() {
        // при прокрутке окна (window)
        window.addEventListener('scroll', () => {
            const scrollY = window.scrollY || document.documentElement.scrollTop;
            if (this.scrolling && scrollY > 0) {
                return;
            }
            this.scrolling = false;
            // если пользователь прокрутил страницу более чем на 200px
            if (scrollY > 400) {
                // сделаем кнопку .btn-up видимой
                this.show();
            } else {
                // иначе скроем кнопку .btn-up
                this.hide();
            }
        });
        // при нажатии на кнопку .btn-up
        document.querySelector('.btn-up').onclick = () => {
            this.scrolling = true;
            this.hide();
            // переместиться в верхнюю часть страницы
            window.scrollTo({
                top: 0,
                left: 0,
                behavior: 'smooth'
            });
        }
    }
}

btnUp.addEventListener();
// появление единичек около корзины
// адаптив

